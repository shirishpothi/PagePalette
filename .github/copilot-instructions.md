# Copilot Instructions

- **Monorepo layout**: Two app folders under apps/: web (React Router) and mobile (Expo Router). Shared sandbox/HMR helpers live in __create/—keep these intact.
- **Package manager**: npm (package-lock.json in each app). Mobile postinstall runs patch-package; do not remove patches/ or the postinstall hook.
- **Web routing**: File-based routing is generated by [apps/web/src/app/routes.ts](apps/web/src/app/routes.ts), which scans for page.jsx files and supports [param] and [...catchall] folder names. Add pages by creating a folder with page.jsx; no manual route table edits.
- **Web shell**: [apps/web/src/app/layout.jsx](apps/web/src/app/layout.jsx) wraps children in a shared TanStack QueryClient (5m staleTime, 30m cacheTime, no refetchOnWindowFocus). [apps/web/src/app/root.tsx](apps/web/src/app/root.tsx) wires sandbox healthcheck/screenshot/codegen messaging plus error boundaries—preserve postMessage listeners and HMR utilities when editing.
- **Web UI**: Global styles/fonts load via root and [apps/web/src/app/global.css](apps/web/src/app/global.css). Core page example lives in [apps/web/src/app/page.jsx](apps/web/src/app/page.jsx) and uses motion/react animations plus components from [apps/web/src/components](apps/web/src/components).
- **Web commands**: From apps/web run `npm run dev` (react-router dev), `npm run build` (react-router build), `npm run start` (serve build), `npm run typecheck` (route typegen + tsc). Vitest deps exist but no script; run `npx vitest` when adding tests under [apps/web/test](apps/web/test).
- **Mobile entry**: Expo app boots via [apps/mobile/index.tsx](apps/mobile/index.tsx) and [apps/mobile/App.tsx](apps/mobile/App.tsx). index.tsx sets SafeAreaProvider, SharedErrorBoundary, sonner-native Toaster, alert polyfill, and sandbox postMessage hooks for navigation/healthcheck. App.tsx wraps the Expo entry with AnythingMenu, DeviceErrorBoundary, and dev-only LogBox override; keeps Buffer polyfill.
- **Mobile routing**: Screens live in [apps/mobile/src/app](apps/mobile/src/app). [_layout.jsx](apps/mobile/src/app/_layout.jsx) provides the shared QueryClient (same defaults as web) and gates rendering on useAuth readiness; Stack header hidden, initialRouteName index. Current [apps/mobile/src/app/index.jsx](apps/mobile/src/app/index.jsx) is a placeholder.
- **Mobile commands**: From apps/mobile run `npm install` (applies patches) then `npx expo start` for development. Metro config and polyfills sit in [apps/mobile/metro.config.js](apps/mobile/metro.config.js) and [apps/mobile/src/__create/polyfills](apps/mobile/src/__create/polyfills).
- **Mobile tests**: jest-expo preset in package.json; run `npx jest` per [apps/mobile/__tests__/README.md](apps/mobile/__tests__/README.md). Sample tests import screens via the expo-router alias '@/app/...'.
- **Error handling**: Both apps rely on SharedErrorBoundary variants and sandbox postMessage hooks; avoid stripping message listeners or changing error serialization unless sandbox tooling is updated too.
- **Data fetching**: TanStack Query config is centralized (web layout, mobile _layout); prefer reusing the provided queryClient instead of creating new instances.
- **Assets & public**: Web assets in [apps/web/public](apps/web/public) (gallery images, logos, models). Mobile assets in [apps/mobile/assets](apps/mobile/assets) and [apps/mobile/public](apps/mobile/public); Expo bundles require import/require for images.
- **Build/deploy notes**: Web build output goes to apps/web/build (client/server) and is served by `npm run start`. Expo build/EAS settings are in [apps/mobile/eas.json](apps/mobile/eas.json) and [apps/mobile/app.json](apps/mobile/app.json); keep IDs/schemes consistent when updating.